<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelVax - Vaccine Recommendations for Travelers</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #fbbc05;
            --danger-color: #ea4335;
            --light-bg: #f8f9fa;
            --dark-bg: #212529;
            --text-color: #333;
            --light-text: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
        }

        .logo-icon {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-container {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .search-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        select {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            font-size: 1rem;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1rem;
            font-weight: 600;
        }

        button:hover {
            background-color: #3367d6;
        }

        .results-container {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .country-info {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .country-flag {
            width: 60px;
            height: 40px;
            object-fit: cover;
            margin-right: 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .vaccines-header {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .vaccine-list {
            list-style: none;
        }

        .vaccine-item {
            background-color: var(--light-bg);
            margin-bottom: 1rem;
            padding: 1.25rem;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }

        .vaccine-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .vaccine-icon {
            margin-right: 0.5rem;
        }

        .vaccine-info {
            margin-bottom: 0.5rem;
        }

        .risk-high {
            border-left-color: var(--danger-color);
        }

        .risk-high .vaccine-name {
            color: var(--danger-color);
        }

        .risk-medium {
            border-left-color: var(--accent-color);
        }

        .risk-medium .vaccine-name {
            color: #d18700;
        }

        .loader {
            display: none;
            margin: 2rem auto;
            text-align: center;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .alert-info {
            background-color: rgba(66, 133, 244, 0.1);
            border-left: 4px solid var(--primary-color);
            color: var(--primary-color);
        }

        .alert-warning {
            background-color: rgba(251, 188, 5, 0.1);
            border-left: 4px solid var(--accent-color);
            color: #d18700;
        }

        .additional-info {
            margin-top: 2rem;
        }

        .additional-info h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .travel-tips {
            background-color: var(--light-bg);
            padding: 1.5rem;
            border-radius: 5px;
            margin-top: 1rem;
        }

        .tips-list {
            list-style: none;
        }

        .tips-list li {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
        }

        .tip-icon {
            margin-right: 0.5rem;
            color: var(--secondary-color);
        }

        footer {
            background-color: var(--dark-bg);
            color: var(--light-text);
            padding: 2rem 0;
            margin-top: 3rem;
            text-align: center;
            font-size: 0.9rem;
        }

        .error-message {
            color: var(--danger-color);
            margin-bottom: 1rem;
            font-weight: 500;
            display: none;
        }

        .health-facts {
            margin-top: 2rem;
            background-color: rgba(66, 133, 244, 0.05);
            padding: 1.5rem;
            border-radius: 5px;
        }

        .health-facts h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .tabs {
            display: flex;
            margin-top: 2rem;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 1.5rem;
            border: 1px solid #ddd;
            border-top: none;
            background-color: white;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .country-info {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .country-flag {
                margin-bottom: 1rem;
            }
            
            .tabs {
                flex-direction: column;
                border-bottom: none;
            }
            
            .tab {
                margin-right: 0;
                margin-bottom: 5px;
                border-radius: 5px;
                border: 1px solid #ddd;
            }
            
            .tab.active {
                border-bottom: 1px solid #ddd;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">ðŸ’‰</div>
            <h1>TravelVax</h1>
        </div>
        <p>Get recommended vaccines for your travel destinations</p>
    </header>

    <div class="container">
        <div class="search-container">
            <div class="search-header">
                <h2>Find Travel Vaccine Recommendations</h2>
                <p>Select a country to see recommended vaccinations for your trip</p>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <form class="search-form" id="searchForm">
                <div class="form-group">
                    <label for="country">Destination Country:</label>
                    <select id="country" required>
                        <option value="">Select a country</option>
                        <!-- Countries will be populated by JavaScript -->
                    </select>
                </div>
                
                <button type="submit">Get Recommendations</button>
            </form>
        </div>
        
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Fetching vaccine recommendations...</p>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div class="country-info" id="countryInfo">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <div class="alert alert-info">
                <strong>Note:</strong> These recommendations are general guidelines. Please consult with a healthcare provider for personalized medical advice.
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="vaccines">Recommended Vaccines</div>
                <div class="tab" data-tab="health">Health Info</div>
                <div class="tab" data-tab="tips">Travel Tips</div>
            </div>
            
            <div class="tab-content active" id="vaccinesTab">
                <h3 class="vaccines-header">Recommended Vaccines</h3>
                <ul class="vaccine-list" id="vaccineList">
                    <!-- Will be populated by JavaScript -->
                </ul>
            </div>
            
            <div class="tab-content" id="healthTab">
                <h3>Local Health Information</h3>
                <div class="health-facts" id="healthInfo">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="tab-content" id="tipsTab">
                <h3>Travel Health Tips</h3>
                <div class="travel-tips">
                    <ul class="tips-list">
                        <li><span class="tip-icon">âœ“</span> Schedule your vaccines 4-6 weeks before travel to ensure full immunity</li>
                        <li><span class="tip-icon">âœ“</span> Carry a record of your vaccinations during your trip</li>
                        <li><span class="tip-icon">âœ“</span> Pack a travel health kit with first-aid supplies and medications</li>
                        <li><span class="tip-icon">âœ“</span> Research healthcare facilities at your destination before departing</li>
                        <li><span class="tip-icon">âœ“</span> Check if travel insurance covers medical evacuation in emergencies</li>
                        <li><span class="tip-icon">âœ“</span> Keep hydrated and use safe water sources</li>
                        <li><span class="tip-icon">âœ“</span> Use insect repellent in areas with mosquito-borne diseases</li>
                        <li><span class="tip-icon">âœ“</span> Avoid eating uncooked foods or drinking untreated water</li>
                        <li><span class="tip-icon">âœ“</span> Bring prescription medications in original packaging with doctor's notes</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 TravelVax | Providing travel health information</p>
        <p>This site provides information for educational purposes only. Always consult a healthcare professional before travel.</p>
    </footer>

    <script>
        // DOM Elements
        const countrySelect = document.getElementById('country');
        const searchForm = document.getElementById('searchForm');
        const loader = document.getElementById('loader');
        const resultsContainer = document.getElementById('resultsContainer');
        const countryInfo = document.getElementById('countryInfo');
        const vaccineList = document.getElementById('vaccineList');
        const healthInfo = document.getElementById('healthInfo');
        const errorMessage = document.getElementById('errorMessage');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // API endpoints and configuration
        const REST_COUNTRIES_API = 'https://restcountries.com/v3.1';
        const GEMINI_API_KEY = 'AIzaSyCBhTkjvvVDYopdn8_MPv6fTalSMTsSW3c';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent';

        // Function to call Gemini API with safety settings
        async function callGeminiAPI(prompt) {
            try {
                console.log('Calling Gemini 1.5 Pro API...');
                
                if (!GEMINI_API_KEY) {
                    throw new Error('Please configure a valid Gemini API key');
                }

                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_NONE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_NONE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_NONE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_NONE"
                            }
                        ],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('Gemini API Error Response:', errorData);
                    throw new Error(`Gemini API failed with status: ${response.status}. ${errorData}`);
                }

                const data = await response.json();
                console.log('Gemini API Response:', data);
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Invalid response format from Gemini API');
                }

                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Error calling Gemini API:', error.message);
                showError(`API Error: ${error.message}. Using fallback data.`);
                return null;
            }
        }

        // Fetch countries from REST Countries API
        async function fetchCountries() {
            try {
                console.log('Fetching countries from REST Countries API...');
                const response = await fetch('https://restcountries.com/v3.1/all');
                if (!response.ok) {
                    throw new Error('Failed to fetch countries');
                }
                const data = await response.json();
                console.log('Countries API Response:', data);
                
                // Sort countries alphabetically by name
                data.sort((a, b) => a.name.common.localeCompare(b.name.common));
                
                // Store the data globally for later use
                window.countriesData = data;
                
                // Populate the dropdown
                const countrySelect = document.getElementById('country');
                if (!countrySelect) {
                    console.error('Country select element not found');
                    return;
                }
                
                // Clear existing options
                countrySelect.innerHTML = '<option value="">Select a country</option>';
                
                // Add countries to dropdown
                data.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.name.common;
                    option.textContent = country.name.common;
                    countrySelect.appendChild(option);
                });
                
                console.log('Countries loaded successfully');
            } catch (error) {
                console.error('Error fetching countries:', error);
                showError('Failed to load countries. Please refresh the page.');
            }
        }

        // Get vaccine recommendations based on country data
        async function getVaccineRecommendations(countryName) {
            showLoader();
            
            try {
                // Find the country data from our stored data
                const countryData = window.countriesData.find(c => c.name.common === countryName);
                
                if (!countryData) {
                    throw new Error('Country data not found');
                }

                console.log('Selected Country Data:', countryData);

                // Generate vaccine recommendations using Gemini API
                const vaccinePrompt = `You are a medical expert providing vaccine recommendations for travelers. 
                Generate a specific list of recommended vaccines for travelers visiting ${countryData.name.common}. 
                
                Country Information:
                - Region: ${countryData.region}${countryData.subregion ? ` (${countryData.subregion})` : ''}
                - Population: ${countryData.population}
                - Languages: ${Object.values(countryData.languages || {}).join(', ')}
                - Capital: ${countryData.capital?.[0] || 'N/A'}
                
                Consider:
                1. Regional disease risks
                2. Local health conditions
                3. Population density
                4. Healthcare infrastructure
                5. Recent disease outbreaks
                
                Return ONLY a JSON array of vaccine objects in this exact format:
                [
                    {
                        "name": "vaccine name",
                        "description": "specific reason for this vaccine in this country",
                        "requirement": "Required",
                        "riskLevel": "High"
                    }
                ]
                
                Include 4-6 most important vaccines. Make descriptions specific to the country.`;

                const vaccineResponse = await callGeminiAPI(vaccinePrompt);
                console.log('Raw Vaccine Response from Gemini:', vaccineResponse);
                let vaccines = [];

                if (vaccineResponse) {
                    try {
                        // Clean the response to extract only the JSON array
                        const cleanedResponse = vaccineResponse
                            .replace(/```json/g, '')
                            .replace(/```/g, '')
                            .trim();
                        
                        console.log('Cleaned Vaccine Response:', cleanedResponse);
                        
                        // Try to parse the JSON
                        const parsedVaccines = JSON.parse(cleanedResponse);
                        console.log('Parsed Vaccine Data:', parsedVaccines);
                        
                        // Validate the structure
                        if (Array.isArray(parsedVaccines) && parsedVaccines.length > 0) {
                            vaccines = parsedVaccines.map(vaccine => ({
                                name: vaccine.name || 'Unknown Vaccine',
                                description: vaccine.description || 'No description available',
                                requirement: vaccine.requirement || 'Recommended',
                                riskLevel: vaccine.riskLevel || 'Medium'
                            }));
                        }
                    } catch (error) {
                        console.error('Error parsing vaccine data:', error);
                    }
                }

                // Fallback to region-specific recommendations if Gemini API fails
                if (vaccines.length === 0) {
                    console.log('Using fallback vaccine recommendations');
                    // Basic vaccines for all countries
                    vaccines = [
                        {
                            name: "MMR",
                            description: "Protects against measles, mumps, and rubella. Essential for international travel.",
                            requirement: "Routine",
                            riskLevel: "Low"
                        },
                        {
                            name: "Tdap",
                            description: "Protects against tetanus, diphtheria, and pertussis. Recommended for all travelers.",
                            requirement: "Routine",
                            riskLevel: "Low"
                        }
                    ];

                    // Region-specific vaccines
                    if (countryData.region === "Africa" || countryData.subregion?.includes("Africa")) {
                        vaccines.push(
                            {
                                name: "Yellow Fever",
                                description: `Required for entry to ${countryData.name.common}. High risk in this region.`,
                                requirement: "Required",
                                riskLevel: "High"
                            },
                            {
                                name: "Hepatitis A",
                                description: "High risk of food and water-borne transmission in this region.",
                                requirement: "Recommended",
                                riskLevel: "High"
                            },
                            {
                                name: "Typhoid",
                                description: "Common in areas with limited access to clean water and food safety concerns.",
                                requirement: "Recommended",
                                riskLevel: "High"
                            }
                        );
                    } else if (countryData.region === "Asia" || countryData.subregion?.includes("Asia")) {
                        vaccines.push(
                            {
                                name: "Hepatitis A",
                                description: "Prevalent in many Asian countries. High risk of transmission.",
                                requirement: "Recommended",
                                riskLevel: "High"
                            },
                            {
                                name: "Typhoid",
                                description: "Common in areas with varying food safety standards.",
                                requirement: "Recommended",
                                riskLevel: "High"
                            },
                            {
                                name: "Japanese Encephalitis",
                                description: "Risk in rural areas, especially during monsoon season.",
                                requirement: "Recommended",
                                riskLevel: "Medium"
                            }
                        );
                    } else if (countryData.region === "Americas" || countryData.subregion?.includes("America")) {
                        vaccines.push(
                            {
                                name: "Hepatitis A",
                                description: "Varying risk levels across different regions of the Americas.",
                                requirement: "Recommended",
                                riskLevel: "Medium"
                            },
                            {
                                name: "Typhoid",
                                description: "Risk varies by region and local sanitation conditions.",
                                requirement: "Recommended",
                                riskLevel: "Medium"
                            }
                        );
                    }

                    // Add population density based recommendations
                    if (countryData.population > 100000000) {
                        vaccines.push(
                            {
                                name: "COVID-19",
                                description: "High population density increases transmission risk.",
                                requirement: "Recommended",
                                riskLevel: "High"
                            },
                            {
                                name: "Influenza",
                                description: "Seasonal flu risk increased in densely populated areas.",
                                requirement: "Recommended",
                                riskLevel: "Medium"
                            }
                        );
                    }
                }

                // Generate health information using Gemini API
                const healthPrompt = `Generate comprehensive health information for travelers visiting ${countryData.name.common}.
                Consider the following information:
                - Region: ${countryData.region}${countryData.subregion ? ` (${countryData.subregion})` : ''}
                - Population: ${countryData.population}
                - Languages: ${Object.values(countryData.languages || {}).join(', ')}
                - Capital: ${countryData.capital?.[0] || 'N/A'}
                - Currencies: ${Object.values(countryData.currencies || {}).map(curr => `${curr.name} (${curr.symbol || 'N/A'})`).join(', ')}
                
                Include information about:
                1. Disease risks and health concerns
                2. Medical facilities and healthcare access
                3. Water and food safety
                4. Local conditions and environmental factors
                5. Cultural considerations related to health
                
                Format the response in HTML with appropriate paragraphs and lists.`;

                let healthInfo = await callGeminiAPI(healthPrompt);
                console.log('Health Info Response from Gemini:', healthInfo);

                // Fallback to basic health info if Gemini API fails
                if (!healthInfo) {
                    console.log('Using fallback health information');
                    healthInfo = generateHealthInfo(countryData);
                }
                
                displayResults(countryData, vaccines, healthInfo);
            } catch (error) {
                console.error('Error:', error);
                showError('Failed to fetch recommendations. Please try again later.');
            } finally {
                hideLoader();
            }
        }

        // Generate health information based on country data
        function generateHealthInfo(countryData) {
            const info = [];
            
            // Basic health information
            info.push(`<p><strong>Region:</strong> ${countryData.region}${countryData.subregion ? ` (${countryData.subregion})` : ''}</p>`);
            
            // Population density consideration
            if (countryData.population > 100000000) {
                info.push(`<p><strong>Population Density:</strong> High population density may increase disease transmission risk.</p>`);
            }
            
            // Language information
            if (countryData.languages) {
                const languages = Object.values(countryData.languages).join(', ');
                info.push(`<p><strong>Languages:</strong> ${languages}</p>`);
            }
            
            // Currency information
            if (countryData.currencies) {
                const currencies = Object.values(countryData.currencies)
                    .map(curr => `${curr.name} (${curr.symbol || 'N/A'})`)
                    .join(', ');
                info.push(`<p><strong>Local Currency:</strong> ${currencies}</p>`);
            }
            
            // Capital information
            if (countryData.capital && countryData.capital.length > 0) {
                info.push(`<p><strong>Capital:</strong> ${countryData.capital[0]}</p>`);
            }
            
            // Region-specific health advice
            if (countryData.region === "Africa" || countryData.subregion?.includes("Africa")) {
                info.push(`
                    <p><strong>Health Considerations:</strong></p>
                    <ul>
                        <li>High risk of malaria in many regions</li>
                        <li>Food and water safety concerns</li>
                        <li>Limited healthcare access in rural areas</li>
                        <li>Yellow fever vaccination may be required</li>
                    </ul>
                `);
            } else if (countryData.region === "Asia" || countryData.subregion?.includes("Asia")) {
                info.push(`
                    <p><strong>Health Considerations:</strong></p>
                    <ul>
                        <li>Food and water safety varies by region</li>
                        <li>Air pollution in major cities</li>
                        <li>Healthcare quality varies significantly</li>
                        <li>High risk of food-borne illnesses</li>
                    </ul>
                `);
            } else if (countryData.region === "Americas" || countryData.subregion?.includes("America")) {
                info.push(`
                    <p><strong>Health Considerations:</strong></p>
                    <ul>
                        <li>Healthcare access varies by region</li>
                        <li>Altitude sickness in mountainous areas</li>
                        <li>Food safety varies by region</li>
                        <li>Mosquito-borne diseases in tropical areas</li>
                    </ul>
                `);
            }
            
            return info.join('');
        }

        // Display results
        function displayResults(countryData, vaccineData, healthData) {
            // Update country info with proper flag URL
            countryInfo.innerHTML = `
                <img class="country-flag" src="${countryData.flags.png}" 
                     alt="${countryData.name.common} flag" 
                     onerror="this.onerror=null; this.src='https://flagcdn.com/w160/${countryData.cca2.toLowerCase()}.png';">
                <div>
                    <h2>${countryData.name.common}</h2>
                    <p>Region: ${countryData.region}${countryData.subregion ? ` (${countryData.subregion})` : ''}</p>
                </div>
            `;
            
            // Clear previous vaccine list
            vaccineList.innerHTML = '';
            
            // Sort vaccines: required first, then by risk level
            vaccineData.sort((a, b) => {
                const reqPriority = { required: 0, recommended: 1, routine: 2 };
                const reqDiff = (reqPriority[a.requirement.toLowerCase()] || 3) - (reqPriority[b.requirement.toLowerCase()] || 3);
                if (reqDiff !== 0) return reqDiff;
                
                const riskPriority = { high: 0, medium: 1, low: 2 };
                return (riskPriority[a.riskLevel.toLowerCase()] || 3) - (riskPriority[b.riskLevel.toLowerCase()] || 3);
            });
            
            // Populate vaccine list
            vaccineData.forEach(vaccine => {
                const riskClass = vaccine.riskLevel.toLowerCase() === 'high' ? 'risk-high' : 
                                 vaccine.riskLevel.toLowerCase() === 'medium' ? 'risk-medium' : '';
                
                const reqLabel = vaccine.requirement.toLowerCase() === 'required' ? 
                                '<span style="color: #ea4335; font-weight: 600;">REQUIRED</span>' : 
                                (vaccine.requirement.toLowerCase() === 'recommended' ? 
                                '<span style="color: #fbbc05; font-weight: 600;">RECOMMENDED</span>' : 
                                '<span style="color: #34a853; font-weight: 600;">ROUTINE</span>');
                
                const li = document.createElement('li');
                li.className = `vaccine-item ${riskClass}`;
                li.innerHTML = `
                    <div class="vaccine-name">
                        <span class="vaccine-icon">ðŸ’‰</span> ${vaccine.name}
                    </div>
                    <div class="vaccine-info">${vaccine.description}</div>
                    <div>
                        <strong>Status:</strong> ${reqLabel} | 
                        <strong>Risk Level:</strong> ${vaccine.riskLevel}
                    </div>
                `;
                
                vaccineList.appendChild(li);
            });
            
            // Update health info
            healthInfo.innerHTML = healthData;
            
            // Show results
            resultsContainer.style.display = 'block';
            
            // Reset to first tab
            tabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            document.querySelector('.tab[data-tab="vaccines"]').classList.add('active');
            document.getElementById('vaccinesTab').classList.add('active');
            
            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Show loader
        function showLoader() {
            loader.style.display = 'block';
            resultsContainer.style.display = 'none';
            errorMessage.style.display = 'none';
        }
        
        // Hide loader
        function hideLoader() {
            loader.style.display = 'none';
        }
        
        // Show error message
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            if (errorMessage) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                // Auto-hide error after 5 seconds
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }
            console.error(message);
        }
        
        // Tab functionality
        function setupTabs() {
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
                });
            });
        }
        
        // Initialize the application
        function init() {
            // Fetch countries when the page loads
            fetchCountries();
            
            // Add form submission handler
            const searchForm = document.getElementById('searchForm');
            if (searchForm) {
                searchForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const countrySelect = document.getElementById('country');
                    if (!countrySelect) {
                        console.error('Country select element not found');
                        return;
                    }
                    
                    const selectedCountry = countrySelect.value;
                    if (!selectedCountry) {
                        showError('Please select a country');
                        return;
                    }
                    
                    // Get vaccine recommendations for the selected country
                    await getVaccineRecommendations(selectedCountry);
                });
            }
            
            // Setup tabs
            setupTabs();
        }

        // Call init when the document is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
